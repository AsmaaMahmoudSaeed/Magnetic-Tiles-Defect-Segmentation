schema: '2.0'
stages:
  data_load:
    cmd: python src/stages/data_load.py --config=params.yaml
    deps:
    - path: src/stages/data_load.py
      hash: md5
      md5: 6f7544708a6cab33db42d479e02eceaa
      size: 928
    - path: src/utils/data_utils.py
      hash: md5
      md5: 777a6cbb80f5d9bb84b76134a91a7f9b
      size: 3483
    params:
      params.yaml:
        base:
          project: defect_detection
          pkg_list_fname: pkg_list.txt
          random_state: 0
        data_load:
          dataset_url: 
            https://github.com/abin24/Magnetic-tile-defect-datasets./archive/refs/heads/master.zip
          data_dir: data
          orig_dirname: Magnetic-tile-defect-datasets.-master
          new_dirname: MAGNETIC_TILE_SURFACE_DEFECTS
    outs:
    - path: data/MAGNETIC_TILE_SURFACE_DEFECTS/images
      hash: md5
      md5: b7178caeac712acf11359c9f183f2cdc.dir
      size: 14666517
      nfiles: 392
    - path: data/MAGNETIC_TILE_SURFACE_DEFECTS/masks
      hash: md5
      md5: b7f6e5772cae0eaada89c08c396e12b7.dir
      size: 191890
      nfiles: 392
  data_split:
    cmd: python src/stages/data_split.py --config=params.yaml
    deps:
    - path: data/MAGNETIC_TILE_SURFACE_DEFECTS/images
      hash: md5
      md5: b7178caeac712acf11359c9f183f2cdc.dir
      size: 14666517
      nfiles: 392
    - path: data/MAGNETIC_TILE_SURFACE_DEFECTS/masks
      hash: md5
      md5: b7f6e5772cae0eaada89c08c396e12b7.dir
      size: 191890
      nfiles: 392
    - path: src/stages/data_split.py
      hash: md5
      md5: cf4dc98a6c407279133aa3048b7e9bec
      size: 1490
    - path: src/utils/data_utils.py
      hash: md5
      md5: 777a6cbb80f5d9bb84b76134a91a7f9b
      size: 3483
    params:
      params.yaml:
        base:
          project: defect_detection
          pkg_list_fname: pkg_list.txt
          random_state: 0
        data_load:
          dataset_url: 
            https://github.com/abin24/Magnetic-tile-defect-datasets./archive/refs/heads/master.zip
          data_dir: data
          orig_dirname: Magnetic-tile-defect-datasets.-master
          new_dirname: MAGNETIC_TILE_SURFACE_DEFECTS
        data_split:
          test_pct: 0.2
          train_img_dir_path: data/MAGNETIC_TILE_SURFACE_DEFECTS/train_images
          train_mask_dir_path: data/MAGNETIC_TILE_SURFACE_DEFECTS/train_masks
          test_img_dir_path: data/MAGNETIC_TILE_SURFACE_DEFECTS/test_images
          test_mask_dir_path: data/MAGNETIC_TILE_SURFACE_DEFECTS/test_masks
    outs:
    - path: data/MAGNETIC_TILE_SURFACE_DEFECTS/test_images
      hash: md5
      md5: 945201efae1f89c50a4c3c325853fc49.dir
      size: 2804818
      nfiles: 78
    - path: data/MAGNETIC_TILE_SURFACE_DEFECTS/test_masks
      hash: md5
      md5: a441943f2e9fc5349f916e822e9282b7.dir
      size: 33123
      nfiles: 78
    - path: data/MAGNETIC_TILE_SURFACE_DEFECTS/train_images
      hash: md5
      md5: 6928706298a6d7ef07013289bd41948f.dir
      size: 11861699
      nfiles: 314
    - path: data/MAGNETIC_TILE_SURFACE_DEFECTS/train_masks
      hash: md5
      md5: 6197bd9920c97a032aaa0b816ee537bd.dir
      size: 158767
      nfiles: 314
  train:
    cmd: python src/stages/train.py --config=params.yaml
    deps:
    - path: data/MAGNETIC_TILE_SURFACE_DEFECTS/train_images
      hash: md5
      md5: 6928706298a6d7ef07013289bd41948f.dir
      size: 11861699
      nfiles: 314
    - path: data/MAGNETIC_TILE_SURFACE_DEFECTS/train_masks
      hash: md5
      md5: 6197bd9920c97a032aaa0b816ee537bd.dir
      size: 158767
      nfiles: 314
    - path: src/stages/train.py
      hash: md5
      md5: 6c5b5de4d75eaee6bdd54ea6532a62ea
      size: 1591
    - path: src/utils/train_utils.py
      hash: md5
      md5: 8719bcb46befd5289697ee5e4a3d9155
      size: 1767
    params:
      params.yaml:
        base:
          project: defect_detection
          pkg_list_fname: pkg_list.txt
          random_state: 0
        data_split:
          test_pct: 0.2
          train_img_dir_path: data/MAGNETIC_TILE_SURFACE_DEFECTS/train_images
          train_mask_dir_path: data/MAGNETIC_TILE_SURFACE_DEFECTS/train_masks
          test_img_dir_path: data/MAGNETIC_TILE_SURFACE_DEFECTS/test_images
          test_mask_dir_path: data/MAGNETIC_TILE_SURFACE_DEFECTS/test_masks
        train:
          img_size: 224
          valid_pct: 0.2
          learning_rate: 0.02
          batch_size: 16
          n_epochs: 15
          use_cpu: false
          model_pickle_fpath: models/model_pickle_fastai.pkl
          augmentations:
            do_flip: false
            flip_vert: false
            max_rotate: 10.0
            min_zoom: 1.0
            max_zoom: 1.0
    outs:
    - path: models/model_pickle_fastai.pkl
      hash: md5
      md5: 3594bd3123d854cd719069b1aaaa0eba
      size: 229789359
    - path: training/metrics.json
      hash: md5
      md5: 95d2e7f60f1b52731f8cf6ed3a11a0bf
      size: 218
    - path: training/plots
      hash: md5
      md5: 65e4bba9c4dc8f338adeca7b91d2e088.dir
      size: 1388
      nfiles: 4
